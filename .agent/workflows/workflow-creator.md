---
description: 创建和优化 workflows 的标准指南。当需要创建新工作流或优化现有工作流时使用。
---

# Workflow 创建指南

本指南用于创建和优化 `.agent/workflows/` 工作流文件。

---

## 工作流概述

工作流是自包含的指南，为特定领域或任务提供专业知识、流程和工具集成。

### 工作流提供的能力

| 类型 | 说明 | 示例 |
|------|------|------|
| 专业流程 | 多步骤领域程序 | UI 组件创建、API 测试 |
| 工具集成 | 特定文件格式或 API 指南 | Git 工作流、构建脚本 |
| 领域知识 | 项目特定的架构、业务逻辑 | 设计系统、编码规范 |

---

## 核心原则

### 1. 简洁是关键

上下文窗口是共享资源。每条信息都要问：**"AI 真的需要这个解释吗？"**

- 优先使用简洁示例而非冗长解释
- 默认假设 AI 已经非常聪明

### 2. 适当的自由度

| 自由度 | 使用场景 | 格式 |
|--------|---------|------|
| 高 | 多种方法有效 | 文本说明 |
| 中 | 存在首选模式 | 伪代码/可配置脚本 |
| 低 | 操作脆弱、需严格一致 | 具体脚本 |

### 3. 渐进式披露

| 层级 | 内容 | 何时加载 |
|------|------|---------|
| Frontmatter | description 描述 | 始终 (~50词) |
| 主体 | 核心流程 | 触发时 (<500行) |
| 引用文件 | 详细参考 | 按需 |

---

## 文件结构

### 必需的 YAML Frontmatter

```yaml
---
description: 一句话描述用途。当需要 [触发条件] 时使用。
---
```

**description 是主要触发机制**，必须包含：

1. 工作流做什么
2. 何时使用（触发条件）

### 目录组织

```text
workflow-name/
├── workflow-name.md   # 主文件 (必需)
├── references/        # 详细文档 (可选)
│   └── detail.md
├── scripts/           # 可执行脚本 (可选)
│   └── helper.py
└── assets/            # 模板/资源 (可选)
    └── template.txt
```

对于简单工作流，单个 `.md` 文件即可：

```text
.agent/workflows/
└── my-workflow.md
```

---

## 自动运行标注

### `// turbo` - 单步自动运行

```markdown
2. 安装依赖
// turbo
3. 运行测试
```

步骤 3 的命令自动执行，步骤 2 需确认。

### `// turbo-all` - 全部自动运行

在文件任意位置添加，所有 `run_command` 步骤自动执行。

---

## 创建流程

### 步骤 1: 理解需求

明确工作流解决的问题：

- 哪些任务会重复执行？
- 需要什么领域知识？
- 什么触发词应启用此工作流？

### 步骤 2: 规划内容

分析需要的资源：

| 类型 | 何时需要 | 示例 |
|------|---------|------|
| scripts/ | 代码被重复编写 | `rotate_pdf.py` |
| references/ | 需要查阅的文档 | `schema.md` |
| assets/ | 输出使用的模板 | `template.html` |

### 步骤 3: 编写工作流

1. 写清晰的 frontmatter description
2. 保持主体 <500 行
3. 详细内容拆分到 references/
4. 为安全命令添加 `// turbo`

### 步骤 4: 验证

- [ ] YAML frontmatter 格式正确
- [ ] description 包含触发条件
- [ ] 步骤编号连续
- [ ] 代码块语言标记正确
- [ ] 只有安全命令标记了 `// turbo`

---

## 模板

### 简单工作流

```markdown
---
description: [用途]。当需要 [触发条件] 时使用。
---

# [名称]

[一句话说明]

## 步骤

// turbo
1. [步骤 1]
\`\`\`bash
[命令]
\`\`\`

2. [步骤 2]

## 验证

- [ ] [检查项]
```

### 多部分工作流

```markdown
---
description: [用途]。当需要 [触发条件] 时使用。
---

# [名称]

## 第一部分: [主题]
[内容]

## 第二部分: [主题]
[内容]

## 审查清单
- [ ] [检查项]
```

---

## 命名规范

- 使用小写字母、数字、连字符
- 动词优先：`build-app`、`deploy-service`
- 领域命名：`ui-design`、`api-testing`
- 保持在 64 字符以内

---

## 避免事项

不要在工作流中包含：

- README.md、CHANGELOG.md 等辅助文档
- 安装指南、用户文档
- 重复信息（内容只在一处）
